<div class="report-container">
  <h1>üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á (Filters) -->
  <section class="filters">
    <h3>‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
    <div class="filter-controls">
      <label>
        ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà:
        <!-- ‡πÉ‡∏ä‡πâ [(ngModel)] ‡∏Å‡∏±‡∏ö Signals ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ [ngModel] ‡πÅ‡∏•‡∏∞ (ngModelChange) ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô -->
        <input type="date" [ngModel]="dateFrom()" (ngModelChange)="dateFrom.set($event)">
      </label>
      <label>
        ‡∏ñ‡∏∂‡∏á:
        <input type="date" [ngModel]="dateTo()" (ngModelChange)="dateTo.set($event)">
      </label>
      <label>
        ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:
        <select [ngModel]="categoryFilter()" (ngModelChange)="categoryFilter.set($event)">
          <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
          <option *ngFor="let cat of categories()" [value]="cat">{{ cat }}</option>
        </select>
      </label>
      <label>
        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:
        <input type="search" placeholder="‡∏ä‡∏∑‡πà‡∏≠/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" [ngModel]="keyword()" (ngModelChange)="keyword.set($event)">
      </label>
      <button class="ghost" (click)="clearFilters()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      <button (click)="exportCSV()">üíæ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV ({{ count() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</button>
    </div>
  </section>

  <hr>
  
  <ng-container *ngIf="count() > 0; else noData">
    <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Stats) -->
    <section class="stats-summary">
      <div class="pill">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <strong>{{ total() | number:'1.2-2' }} ‡∏ö‡∏≤‡∏ó</strong></div>
      <div class="pill">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <strong>{{ count() }}</strong></div>
      <div class="pill">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <strong>{{ avg() | number:'1.2-2' }} ‡∏ö‡∏≤‡∏ó</strong></div>
    </section>

    <!-- üí° ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°: ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Pie Chart) -->
    <h2>üìä ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
    <div class="chart-area pie-chart">
      <!-- ‡πÉ‡∏ä‡πâ BaseChartDirective ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ Import ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ -->
      <canvas baseChart 
        [data]="pieChartData()" 
        [type]="pieChartType"
        [options]="{ maintainAspectRatio: false }"
        style="height: 400px; max-width: 600px; margin: 0 auto; display: block;">
      </canvas>
    </div>

    <!-- üí° ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô: ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Line Chart) -->
    <h2>üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
    <div class="chart-area line-chart">
      <!-- ‡πÉ‡∏ä‡πâ BaseChartDirective ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤ Import ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ -->
      <canvas baseChart 
        [data]="lineChartData()" 
        [type]="lineChartType"
        [options]="{ maintainAspectRatio: false }"
        style="height: 400px; width: 100%;">
      </canvas>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Bar Chart ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢) -->
    <h2>üìâ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
    <div class="category-bars">
      <div *ngFor="let item of byCategory()" class="bar-item">
        <span class="category-name">{{ item[0] }}</span>
        <span class="category-amount">{{ item[1] | number:'1.2-2' }} ‡∏ö‡∏≤‡∏ó</span>
        <div class="bar-visual">
          <div class="bar-fill" [style.width]="barWidth(item[1])"></div>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #noData>
    <div class="empty-state">
      <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</p>
      <button class="ghost" (click)="clearFilters()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
    </div>
  </ng-template>

</div>
